# work log 2020/11/09 - 2020/12/10



## 2020 -11-09 Monday

准备 1Password，Slack，Gmail，GitHub，熟悉环境和各种工具，运行项目



## 2020 -11-10 Tuesday

- 查看项目的依赖（表示很焦虑，第三方依赖过多，具有大量重复依赖）
- 熟悉项目当前状态
- 了解项目的运行环境
- 了解项目的业务构成
- 获取项目可获取的少量资料，比如设计稿地址
- 查看闪屏到主页面的流程（代码太烂，需要大量时间找到功能入口）



## 2020 -11-11 Wednesday

- 利用设计稿熟悉项目具体的业务流程
- 抽取项目运行环境常量，同时整理思路



## 2020-11-12 Thursday

- 阅读了启动初始化的代码，请求的接口分别：
  - ConsumerGetApi
  - ConsumerTagsGetApi
  - ConsumerTagsPutApi
- 发现使用 TinyTask（Thread）的异步任务处理方式应该也造成了不少性能问题，建议改用线程池，或者去除
- 阅读部分老的代码，大致了解最近使用的代码架构
- 重新熟悉 kotlin，mvvm



## 2020-11-13 Friday

- 开始执行 coupon scan 任务，进行功能分析和拆分
- 查看类似功能的样式，尽量复用
- 进行基本页面的代码编写



## 2020-11-14 Saturday

- 继续通过设计稿了解业务流程
- 继续熟悉 kt 以及 mvvm



## 2020-11-16 Monday

- 页面基本完成，着手进行数据填充
- 熟悉当前项目的数据库第三方框架，修改代码，获取本地数据
- 查看获取 crossReference 的方法
- 熟悉用户模块（登录功能流程，流程写的过于复杂，滥用 EventBus）



## 2020-11-17 Tuesday

- 最后找到 CrossReferenceManager 的 api 可以获取到 crossReference，虽然代码中登录返回的数据结构也有 crossReference，但还是经过测试并没有
- 完成数据获取逻辑和测试数据填充
- 页面的最后调整



## 2020-11-18 Wednesday

- 修复了 viewpager2 Fragment 单页刷新 bug
- 修复了 coupon 描述信息无的问题（持久数据模型里面添加字段）
- 测试了覆盖安装，发现数据库现在的操作策略是**遇到要迁徙的情况（抛出异常）就删除重建**
  - 这种做法肯定是错误的，但是考虑当前项目混乱，先不去深究



## 2020-11-19 Thursday

- 开会了解 POC 及 overflow
- 阅读了 firebase GA 文档
- 删除了 fabric 残留代码，完全使用 Firebase GA



## 2020-11-20 Friday

- 修改了 firebase 的 paymentType args，并测试
- 添加了 firebase map_select_store event，并测试
- 添加信用卡管理页面文字
- coupon scan generate failed work

> https://theplanttokyo.atlassian.net/browse/MDX-1790
>
> https://theplanttokyo.atlassian.net/browse/MDX-1783
>
> https://theplanttokyo.atlassian.net/browse/MDX-1742
>
> https://theplanttokyo.atlassian.net/browse/MDX-1822 



## 2020-11-23 Monday

- 熟悉老的设计稿使用的样式标准
- 完善信用卡管理页面文字的样式

> https://theplanttokyo.atlassian.net/browse/MDX-1787

- 分析 Usabilla 升级后崩溃的原因



## 2020-11-24 Tuesday

- 调研 JP Android 设备机型
- 添加 coupon loading ui
- 检查项目原来的 loading ui，发现了一处性能问题
  - frameSurfaceView 在无任何 ui 绘制的情况下内部线程一直在空转
  - 影响：无任何操作情况下，cpu 占用率依然有 10-16%，这也会导致电池耗电加快
  - 修复和重构：在封装加载控件的同时，重构修复了内部线程空转问题，无任何操作下，cpu 占用率 0%-6%（正常）
- 发现了自定义控件的尺寸测量问题，重构 fix



## 2020-11-25 Wednesday

- 测试重构后的代码，提交 PR。和同事分享了性能问题产生的原因

- 查看 HomeNewFragment 代码和布局（问题：ConstraintLayout 层级太多，同样会影响性能）

  

## 2020-11-26 Thursday

- 修改 firebase 事件 map_select_store，参数是 store_id & from_search
- 修改 copon scan 获取 crossReference 的形参
- 添加自定义控件：循环播报控件，封装细节，优化播报执行（可见下播报，非可见下停止消息空转）
  - 设计待定，可能并不会使用该控件
- 熟悉另外一部分网络请求模块（retrofit+rxjava）



## 2020-11-27 Friday

- 调查字体过大问题，确定解决方案
  - cjk 其实包含了中日韩三国四种字体图形，字体包过大，因此并不是手机操作系统里面使用的方案
  - 直接使用 note sans jp 替代 noto sans cjk jp 字体可以减少 49-12=37MB 大小
- 重写通知控件，无播报执行





## 2020-11-30 Monday

- 重写通知控件
- 学习协程



## 2020-12-01 Tuesday

- 完成 emergencies notification
  - ui 
  - 点击行为，webview 打开
  - view 的重建优化



## 2020-12-02 Wednesday

- 根据被指派的 bug，熟悉选店，优惠券选餐，挑选产品
- 熟悉追踪这部分流程的代码



## 2020-12-03 Thursday

- 熟悉 usabilla 代码
- 查阅熟悉了 gradle denpendencies 的一些问题和解决
- coupon qrcode scan 对高宽比 1.7 的手机进行了适配



## 2020-12-04 Friday

- usabilla 升级：
  - 排除 playstore 问题
  - 排除 kt 问题
  - 排除 exifinterface
  - 排除 androidx
- 删除非相关因素：okhttp2



## 2020-12-06 Sunday

usabilla 升级成功，对比依赖总结问题原因：

- 删除 kt 的强制固定版本，升级 kt 插件版本到 1.3.72，升级 kotlin-stdlib-jdk8/7 到1.3.72
- 升级 moshi 到 1.11.0
- 去除 desugaring = false
- kt 可以同步为 1.4.10



## 2020-12-07 Monday

- 完成 kt 升级为 1.4.10 的处理（涉及firebase 的升级，rxjava 的升级）
- 看了 splash 闪屏的任务，发现设计与实现都有问题，指出



## 2020-12-08 Tuesday

- 修改 notification（有连接的不显示黑色箭头）
- 修改食物详情页面过敏信息（两次）
- 修改 firebase 优惠券的 item 的显示问题



## 2020-12-09 Wednesday

- Code Review
- 了解打包流程
- 写 checklist



## 2020-12-10 Thursday

- 移除 zip 和数据库效验机制，解除了 zipcode 无法更新：

  > https://theplanttokyo.atlassian.net/browse/MDX-1580 

- revert splash image

- https://theplanttokyo.atlassian.net/browse/MDX-1849 下单出现 “Open Choice error”，了解这个错误的来龙去脉

  > https://theplanttokyo.atlassian.net/browse/MDX-1563 需要参考这个 issue